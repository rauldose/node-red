@* Syncfusion Blazor Accordion Component Wrapper *@
@* Replaces custom stack with Syncfusion Accordion *@

<SfAccordion ExpandMode="ExpandMode.Multiple" CssClass="red-ui-stack">
    <AccordionItems>
        @foreach (var item in Sections)
        {
            <AccordionItem Expanded="@(!item.Collapsed)">
                <HeaderTemplate>
                    <div>
                        @item.Title
                        @if (!string.IsNullOrEmpty(item.Badge))
                        {
                            <span class="red-ui-stack-badge">@item.Badge</span>
                        }
                    </div>
                </HeaderTemplate>
                <ContentTemplate>
                    @item.Content
                </ContentTemplate>
            </AccordionItem>
        }
    </AccordionItems>
    <AccordionEvents Expanding="@OnExpandingWrapper" 
                     Collapsed="@OnCollapsedWrapper" />
</SfAccordion>

@code {
    [Parameter] public List<StackSection> Sections { get; set; } = new();
    [Parameter] public EventCallback<StackSection> OnSectionToggle { get; set; }

    private async Task OnExpandingWrapper()
    {
        // Wrapper for non-generic EventCallback
        await Task.CompletedTask;
    }

    private async Task OnCollapsedWrapper()
    {
        // Wrapper for non-generic EventCallback
        await Task.CompletedTask;
    }

    private async Task OnExpanding(ExpandEventArgs args)
    {
        var item = Sections.ElementAtOrDefault(args.Index);
        if (item != null)
        {
            item.Collapsed = false;
            await OnSectionToggle.InvokeAsync(item);
        }
    }

    private async Task OnCollapsed(CollapseEventArgs args)
    {
        var item = Sections.ElementAtOrDefault(args.Index);
        if (item != null)
        {
            item.Collapsed = true;
            await OnSectionToggle.InvokeAsync(item);
        }
    }

    public class StackSection
    {
        public string Title { get; set; } = "";
        public string? Badge { get; set; }
        public bool Collapsed { get; set; } = false;
        public RenderFragment? Content { get; set; }
    }
}
