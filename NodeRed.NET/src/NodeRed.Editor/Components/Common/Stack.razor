@* Syncfusion Blazor Accordion Component Wrapper *@
@* Replaces custom stack with Syncfusion Accordion *@

<SfAccordion ExpandMode="ExpandMode.Multiple" CssClass="red-ui-stack">
    <AccordionItems>
        @foreach (var section in Sections)
        {
            <AccordionItem Expanded="@(!section.Collapsed)">
                <HeaderTemplate>
                    <div>
                        @section.Title
                        @if (!string.IsNullOrEmpty(section.Badge))
                        {
                            <span class="red-ui-stack-badge">@section.Badge</span>
                        }
                    </div>
                </HeaderTemplate>
                <ContentTemplate>
                    @section.Content
                </ContentTemplate>
            </AccordionItem>
        }
    </AccordionItems>
    <AccordionEvents Expanding="@OnExpanding" Collapsed="@OnCollapsed" />
</SfAccordion>

@code {
    [Parameter] public List<StackSection> Sections { get; set; } = new();
    [Parameter] public EventCallback<StackSection> OnSectionToggle { get; set; }

    private async Task OnExpanding(ExpandEventArgs args)
    {
        var section = Sections.ElementAtOrDefault(args.Index);
        if (section != null)
        {
            section.Collapsed = false;
            await OnSectionToggle.InvokeAsync(section);
        }
    }

    private async Task OnCollapsed(CollapseEventArgs args)
    {
        var section = Sections.ElementAtOrDefault(args.Index);
        if (section != null)
        {
            section.Collapsed = true;
            await OnSectionToggle.InvokeAsync(section);
        }
    }

    public class StackSection
    {
        public string Title { get; set; } = "";
        public string? Badge { get; set; }
        public bool Collapsed { get; set; } = false;
        public RenderFragment? Content { get; set; }
    }
}
