@namespace NodeRed.Editor.Components.Common

@* Syncfusion Blazor CheckBox Component Wrapper *@
@* Replaces custom checkboxSet with Syncfusion CheckBox *@

<div class="red-ui-checkboxSet @(Inline ? "red-ui-checkboxSet-inline" : "")">
    @foreach (var option in Options)
    {
        <SfCheckBox @key="option.Value"
                    Label="@option.Label"
                    Checked="@IsSelected(option.Value)"
                    Disabled="@Disabled"
                    ValueChange="@((Syncfusion.Blazor.Buttons.ChangeEventArgs<bool> args) => OnOptionChanged(option.Value, args.Checked))"
                    CssClass="red-ui-checkboxSet-item">
        </SfCheckBox>
    }
</div>

@code {
    [Parameter] public List<CheckboxOption> Options { get; set; } = new();
    [Parameter] public List<string> SelectedValues { get; set; } = new();
    [Parameter] public EventCallback<List<string>> SelectedValuesChanged { get; set; }
    [Parameter] public bool Inline { get; set; } = true;
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public EventCallback<CheckboxChangeEventArgs> OnChange { get; set; }

    public class CheckboxOption
    {
        public string Value { get; set; } = "";
        public string Label { get; set; } = "";
        public string? Icon { get; set; }
    }

    public class CheckboxChangeEventArgs
    {
        public string Value { get; set; } = "";
        public bool Checked { get; set; }
        public List<string> SelectedValues { get; set; } = new();
    }

    private bool IsSelected(string value) => SelectedValues.Contains(value);

    private async Task OnOptionChanged(string value, bool isChecked)
    {
        var newSelection = new List<string>(SelectedValues);
        
        if (isChecked && !newSelection.Contains(value))
        {
            newSelection.Add(value);
        }
        else if (!isChecked && newSelection.Contains(value))
        {
            newSelection.Remove(value);
        }

        SelectedValues = newSelection;
        await SelectedValuesChanged.InvokeAsync(newSelection);
        await OnChange.InvokeAsync(new CheckboxChangeEventArgs
        {
            Value = value,
            Checked = isChecked,
            SelectedValues = newSelection
        });
    }
}

<style>
    .red-ui-checkboxSet {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .red-ui-checkboxSet-inline {
        flex-direction: row;
        flex-wrap: wrap;
    }
</style>
