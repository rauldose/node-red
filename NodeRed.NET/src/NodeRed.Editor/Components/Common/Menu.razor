@* Syncfusion Blazor ContextMenu Component Wrapper *@
@* Replaces custom menu with Syncfusion ContextMenu *@

<SfContextMenu @ref="MenuRef" TValue="MenuItem" Target="@Target" Items="@Items" CssClass="red-ui-menu">
    <MenuEvents TValue="MenuItem" ItemSelected="@OnMenuItemSelected" />
    <MenuFieldSettings Text="Label" IconCss="Icon" Children="Items" />
</SfContextMenu>

@code {
    [Parameter] public List<MenuItem> Items { get; set; } = new();
    [Parameter] public string Target { get; set; } = "body";
    [Parameter] public EventCallback<MenuItem> OnSelect { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }
    
    private SfContextMenu<MenuItem>? MenuRef;
    
    private async Task OnMenuItemSelected(MenuEventArgs<MenuItem> args)
    {
        if (args.Item != null && !args.Item.Disabled && (args.Item.Items == null || !args.Item.Items.Any()))
        {
            await OnSelect.InvokeAsync(args.Item);
            await OnClose.InvokeAsync();
            
            // Invoke the OnClick handler if present
            args.Item.OnClick?.Invoke();
        }
    }
    
    public async Task Open(double left, double top)
    {
        if (MenuRef != null)
        {
            await MenuRef.OpenAsync(top, left);
        }
    }
    
    public async Task Close()
    {
        if (MenuRef != null)
        {
            // Syncfusion ContextMenu doesn't have CloseAsync - it closes automatically on selection
            // or we can use HideAsync if needed
            StateHasChanged();
        }
    }
    
    public class MenuItem
    {
        public string Id { get; set; } = Guid.NewGuid().ToString();
        public string Label { get; set; } = "";
        public string? Icon { get; set; }
        public string? Shortcut { get; set; }
        public bool Disabled { get; set; }
        public bool IsSeparator { get; set; }
        public List<MenuItem>? Items { get; set; }
        public Action? OnClick { get; set; }
        
        public static MenuItem Separator() => new MenuItem { IsSeparator = true };
    }
}

