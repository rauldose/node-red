@* Source: @node-red/editor-client/src/js/ui/common/menu.js *@
@* Translated to Blazor for NodeRed.NET *@

<div class="red-ui-menu @(IsOpen ? "open" : "")" style="@GetPositionStyle()" @onmousedown:stopPropagation>
    @if (IsOpen)
    {
        <ul class="red-ui-menu-list">
            @foreach (var item in Items)
            {
                @if (item.IsSeparator)
                {
                    <li class="red-ui-menu-separator"></li>
                }
                else
                {
                    <li class="red-ui-menu-item @(item.Disabled ? "disabled" : "") @(item.Items?.Any() == true ? "has-submenu" : "")"
                        @onclick="() => OnItemClick(item)"
                        @onmouseenter="() => OpenSubmenu(item)">
                        @if (!string.IsNullOrEmpty(item.Icon))
                        {
                            <i class="fa @item.Icon red-ui-menu-icon"></i>
                        }
                        else
                        {
                            <span class="red-ui-menu-icon-placeholder"></span>
                        }
                        <span class="red-ui-menu-label">@item.Label</span>
                        @if (!string.IsNullOrEmpty(item.Shortcut))
                        {
                            <span class="red-ui-menu-shortcut">@item.Shortcut</span>
                        }
                        @if (item.Items?.Any() == true)
                        {
                            <i class="fa fa-caret-right red-ui-menu-submenu-arrow"></i>
                        }
                        
                        @if (item.Items?.Any() == true && _openSubmenu == item.Id)
                        {
                            <ul class="red-ui-menu-submenu">
                                @foreach (var subItem in item.Items)
                                {
                                    <li class="red-ui-menu-item @(subItem.Disabled ? "disabled" : "")"
                                        @onclick="() => OnItemClick(subItem)">
                                        @if (!string.IsNullOrEmpty(subItem.Icon))
                                        {
                                            <i class="fa @subItem.Icon red-ui-menu-icon"></i>
                                        }
                                        <span class="red-ui-menu-label">@subItem.Label</span>
                                    </li>
                                }
                            </ul>
                        }
                    </li>
                }
            }
        </ul>
    }
</div>

@code {
    [Parameter] public List<MenuItem> Items { get; set; } = new();
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public double Left { get; set; }
    [Parameter] public double Top { get; set; }
    [Parameter] public EventCallback<MenuItem> OnSelect { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }
    
    private string? _openSubmenu;
    
    private string GetPositionStyle()
    {
        return $"left: {Left}px; top: {Top}px;";
    }
    
    private async Task OnItemClick(MenuItem item)
    {
        if (item.Disabled || item.Items?.Any() == true)
        {
            return;
        }
        
        await OnSelect.InvokeAsync(item);
        await OnClose.InvokeAsync();
    }
    
    private void OpenSubmenu(MenuItem item)
    {
        if (item.Items?.Any() == true)
        {
            _openSubmenu = item.Id;
        }
        else
        {
            _openSubmenu = null;
        }
    }
    
    public class MenuItem
    {
        public string Id { get; set; } = Guid.NewGuid().ToString();
        public string Label { get; set; } = "";
        public string? Icon { get; set; }
        public string? Shortcut { get; set; }
        public bool Disabled { get; set; }
        public bool IsSeparator { get; set; }
        public List<MenuItem>? Items { get; set; }
        public Action? OnClick { get; set; }
        
        public static MenuItem Separator() => new MenuItem { IsSeparator = true };
    }
}

<style>
    .red-ui-menu {
        position: absolute;
        z-index: 10000;
        display: none;
        min-width: 160px;
        background: white;
        border: 1px solid #ccc;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    .red-ui-menu.open {
        display: block;
    }
    .red-ui-menu-list {
        list-style: none;
        margin: 0;
        padding: 4px 0;
    }
    .red-ui-menu-item {
        display: flex;
        align-items: center;
        padding: 6px 12px;
        cursor: pointer;
        position: relative;
    }
    .red-ui-menu-item:hover {
        background-color: #e6f0fa;
    }
    .red-ui-menu-item.disabled {
        color: #999;
        cursor: default;
    }
    .red-ui-menu-item.disabled:hover {
        background-color: transparent;
    }
    .red-ui-menu-separator {
        height: 1px;
        background-color: #ddd;
        margin: 4px 0;
    }
    .red-ui-menu-icon {
        width: 16px;
        margin-right: 8px;
        text-align: center;
    }
    .red-ui-menu-icon-placeholder {
        width: 16px;
        margin-right: 8px;
    }
    .red-ui-menu-label {
        flex: 1;
    }
    .red-ui-menu-shortcut {
        color: #888;
        font-size: 0.9em;
        margin-left: 16px;
    }
    .red-ui-menu-submenu-arrow {
        margin-left: 8px;
    }
    .red-ui-menu-submenu {
        position: absolute;
        left: 100%;
        top: 0;
        list-style: none;
        margin: 0;
        padding: 4px 0;
        min-width: 140px;
        background: white;
        border: 1px solid #ccc;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
</style>
