@* Syncfusion Blazor AutoComplete Component Wrapper *@
@* Replaces custom autoComplete with Syncfusion AutoComplete *@

<SfAutoComplete @ref="AutoCompleteRef"
                TValue="string"
                TItem="AutoCompleteOption"
                DataSource="@Options"
                @bind-Value="@Value"
                Placeholder="@Placeholder"
                CssClass="red-ui-autocomplete"
                ShowPopupButton="false"
                AllowFiltering="true"
                FilterType="FilterType.Contains">
    <AutoCompleteFieldSettings Value="Value" Text="Label" />
    <AutoCompleteTemplates TItem="AutoCompleteOption">
        <ItemTemplate>
            @{
                var item = context as AutoCompleteOption;
            }
            <div class="autocomplete-item">
                @if (!string.IsNullOrEmpty(item?.Icon))
                {
                    <i class="fa @item.Icon"></i>
                }
                <span class="option-label">@item?.Label</span>
                @if (!string.IsNullOrEmpty(item?.Description))
                {
                    <span class="option-description">@item.Description</span>
                }
            </div>
        </ItemTemplate>
    </AutoCompleteTemplates>
    <AutoCompleteEvents TValue="string" TItem="AutoCompleteOption" ValueChange="@OnValueChange" />
</SfAutoComplete>

@code {
    [Parameter] public List<AutoCompleteOption> Options { get; set; } = new();
    [Parameter] public string Value { get; set; } = "";
    [Parameter] public string Placeholder { get; set; } = "";
    [Parameter] public EventCallback<AutoCompleteOption> OnSelect { get; set; }
    
    private SfAutoComplete<string, AutoCompleteOption>? AutoCompleteRef;
    
    private async Task OnValueChange(ChangeEventArgs<string, AutoCompleteOption> args)
    {
        if (args.ItemData != null)
        {
            await OnSelect.InvokeAsync(args.ItemData);
        }
    }
    
    public async Task ShowPopup()
    {
        if (AutoCompleteRef != null)
        {
            await AutoCompleteRef.ShowPopupAsync();
        }
    }
    
    public async Task HidePopup()
    {
        if (AutoCompleteRef != null)
        {
            await AutoCompleteRef.HidePopupAsync();
        }
    }
    
    public class AutoCompleteOption
    {
        public string Label { get; set; } = "";
        public string? Value { get; set; }
        public string? Icon { get; set; }
        public string? Description { get; set; }
        public object? Data { get; set; }
    }
}

<style>
    .autocomplete-item {
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .autocomplete-item .option-label {
        flex: 1;
    }
    .autocomplete-item .option-description {
        color: #888;
        font-size: 0.9em;
    }
</style>

